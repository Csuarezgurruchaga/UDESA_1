help(cboxTidwell)
help(boxTidwell)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1],max.iter=50)$result
print("PoblaDens")
car::boxTidwell(l10muertes.permil~PoblaDens, data=df7[,-1],max.iter=50)$result
print("PBI")
car::boxTidwell(l10muertes.permil~PBI, data=df7[,-1],max.iter=50)$result
print("Tiempo")
car::boxTidwell(l10muertes.permil~Tiempo, data=df7[,-1],max.iter=50)$result
print("Camas")
car::boxTidwell(l10muertes.permil~Camas, data=df7[,-1],max.iter=50)$result
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1],max.iter=150)$result
print("PoblaDens")
car::boxTidwell(l10muertes.permil~PoblaDens, data=df7[,-1],max.iter=150)$result
print("PBI")
car::boxTidwell(l10muertes.permil~PBI, data=df7[,-1],max.iter=150)$result
print("Tiempo")
car::boxTidwell(l10muertes.permil~Tiempo, data=df7[,-1],max.iter=150)$result
print("Camas")
car::boxTidwell(l10muertes.permil~Camas, data=df7[,-1],max.iter=150)$result
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1])$result
print("PBI")
car::boxTidwell(l10muertes.permil~PBI, data=df7[,-1])$result
print("Tiempo")
car::boxTidwell(l10muertes.permil~Tiempo, data=df7[,-1])$result
print("Camas")
car::boxTidwell(l10muertes.permil~Camas, data=df7[,-1])$result
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1])$result
print("PBI")
car::boxTidwell(l10muertes.permil~PBI, data=df7[,-1])$result
print("Camas")
car::boxTidwell(l10muertes.permil~Camas, data=df7[,-1])$result
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
df7$PBI          = log(df7$PBI)
df7$Camas        = log(df7$Camas)
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
df7$Camas        = log(df7$Camas)
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1])$result
print("PBI")
car::boxTidwell(l10muertes.permil~PBI, data=df7[,-1])$result
print("Camas")
car::boxTidwell(l10muertes.permil~Camas, data=df7[,-1])$result
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
df7$Camas        = log(df7$Camas)
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
df7$PBI          = log(df7$PBI)
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1])$result
print("PBI")
car::boxTidwell(l10muertes.permil~PBI, data=df7[,-1])$result
print("Camas")
car::boxTidwell(l10muertes.permil~Camas, data=df7[,-1])$result
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
df7$PBI          = log(df7$PBI)
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1])$result
print("PBI")
car::boxTidwell(l10muertes.permil~PBI, data=df7[,-1])$result
print("Camas")
car::boxTidwell(l10muertes.permil~Camas, data=df7[,-1])$result
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
df7$PBI          = log(df7$PBI)
df7$PoblaDens    = log(df7$PoblaDens)
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1])$result
print("PBI")
car::boxTidwell(l10muertes.permil~PBI, data=df7[,-1])$result
print("Camas")
car::boxTidwell(l10muertes.permil~Camas, data=df7[,-1])$result
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
df7$PBI          = log(df7$PBI)
df7$PoblaDens    = 1/df7$PoblaDens
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData+PBI+Camas, data=df7[,-1])$result
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData+PBI, data=df7[,-1])$result
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData+PBI, data=df7[,-1])$result
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
wise_modelo_muertes_permil_V4 = step(modelo_l10muertes_outliers, direction = c("both"),
trace = F)
formula_elegida = wise_modelo_muertes_permil_V4$call$formula
summary(wise_modelo_muertes_permil_V4)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData+PBI+Camas, data=df7[,-1])$result
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
df7$PBI          = log(df7$PBI)
df7$PoblaDens    = 1/df7$PoblaDens
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
wise_modelo_muertes_permil_V4 = step(modelo_l10muertes_outliers, direction = c("both"),
trace = F)
formula_elegida = wise_modelo_muertes_permil_V4$call$formula
summary(wise_modelo_muertes_permil_V4)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$Tiempo = df7$Tiempo+0.01
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData+PBI+Camas, data=df7[,-1])$result
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
df7$PBI          = log(df7$PBI)
#df7$PoblaDens    = 1/df7$PoblaDens
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
wise_modelo_muertes_permil_V4 = step(modelo_l10muertes_outliers, direction = c("both"),
trace = F)
formula_elegida = wise_modelo_muertes_permil_V4$call$formula
summary(wise_modelo_muertes_permil_V4)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
#df7$PBI          = log(df7$PBI)
#df7$PoblaDens    = 1/df7$PoblaDens
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
wise_modelo_muertes_permil_V4 = step(modelo_l10muertes_outliers, direction = c("both"),
trace = F)
formula_elegida = wise_modelo_muertes_permil_V4$call$formula
summary(wise_modelo_muertes_permil_V4)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
#df7$PBI          = log(df7$PBI)
df7$PoblaDens    = 1/df7$PoblaDens
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
wise_modelo_muertes_permil_V4 = step(modelo_l10muertes_outliers, direction = c("both"),
trace = F)
formula_elegida = wise_modelo_muertes_permil_V4$call$formula
summary(wise_modelo_muertes_permil_V4)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData    = 1/df$PoblaData
#df7$PBI          = log(df7$PBI)
df7$PoblaDens    = log(df7$PoblaDens)
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
print("casos.permil")
car::boxTidwell(l10muertes.permil~casos.permil, data=df7[,-1])$result
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData+PBI+Camas, data=df7[,-1])$result
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
print("casos.permil")
car::boxTidwell(l10muertes.permil~casos.permil, data=df7[,-1])$result
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1])$result
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
print("casos.permil")
car::boxTidwell(l10muertes.permil~casos.permil, data=df7[,-1])$result
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaDens, data=df7[,-1])$result
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
print("casos.permil")
car::boxTidwell(l10muertes.permil~casos.permil, data=df7[,-1])$result
print("PoblaData")
car::boxTidwell(l10muertes.permil~PoblaData, data=df7[,-1])$result
df7$casos.permil = log(df7$casos.permil)
df7$PoblaData = 1/df7$PoblaData
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
wise_modelo_muertes_permil_V4 = step(modelo_l10muertes_outliers, direction = c("both"),
trace = F)
formula_elegida = wise_modelo_muertes_permil_V4$call$formula
summary(wise_modelo_muertes_permil_V4)
plot(wise_modelo_muertes_permil_V4)
modelo_MM_covid_log = lmrobdetMM(formula_elegida,
data = select_if(df7,is.numeric), control = control)
summary(modelo_MM_covid_log)
plot(modelo_MM_covid_log$residuals,modelo_MM_covid_log$rweights)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
car::boxTidwell(l10muertes.permil~casos.permil, data=df7[,-1])
df7$casos.permil = log(df7$casos.permil)
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
wise_modelo_muertes_permil_V4 = step(modelo_l10muertes_outliers, direction = c("both"),
trace = F)
formula_elegida = wise_modelo_muertes_permil_V4$call$formula
summary(wise_modelo_muertes_permil_V4)
plot(wise_modelo_muertes_permil_V4)
knitr::opts_chunk$set(echo = TRUE)
library(car)
library(dplyr)
library(corrplot)
library(RobStatTM)
library(glmnet)
set.seed(101)
COVID = read.csv("COVID.txt", sep="")
dim(COVID)
summary(COVID)
attach(COVID)
par(mfrow=c(1, 2))
boxplot(muertes.permil ~ BCGf,
main = "Muertes por millón de habitantes",
ylab = "Muertes.permil", col=c("thistle","wheat"),
cex = 0.7, xlab = "Estrategia de inmunización",
names = c("selectiva", "todos"))
boxplot(l10muertes.permil ~ BCGf,
main = "Muertes por millón [log]",
ylab = "log10muertes.permil", col=c("thistle","wheat"),
cex = 0.7, xlab = "Estrategia de inmunización",
names = c("selectiva", "todos"))
#cor(COVID[,-c(1,2,34)])
plot(PBI,l10muertes.permil)
cor(PBI,l10muertes.permil)
plot(PoblaMid,l10muertes.permil)
plot(Pobla65,l10muertes.permil)
plot(Pobla80,l10muertes.permil)
cor(PoblaMid,l10muertes.permil)
cor(Pobla65,l10muertes.permil)
cor(Pobla80,l10muertes.permil)
plot(TempMarzo,l10muertes.permil)
cor(TempMarzo,l10muertes.permil)
mean(l10muertes.permil[TempMarzo > 20] < 1)
plot(Tiempo,TempMarzo)
mean(Tiempo[TempMarzo > 20] > 60)
plot(Camas,l10muertes.permil)
cor(Camas,l10muertes.permil)
plot(Medicos,l10muertes.permil)
cor(Medicos,l10muertes.permil)
df = COVID[ ,c(5:7, 10, 11, 12, 23, 24, 25, 26, 27, 35)]
pairs(df[ ,c("l10muertes.permil", "Pobla80", "Pobla65",
"PBI", "Tuberculosis", "Medicos", "Camas")])
plot(Urbano,l10muertes.permil)
cor(Urbano,l10muertes.permil)
COVID$Incidencia = round(COVID$muertes / COVID$casos,2)
hist(COVID$Incidencia)
COVID %>%
filter((COVID$Incidencia>.1)) %>%
select('CntrName')
df = COVID %>%
mutate(alto = case_when(Incidencia > .1 ~ 1, Incidencia <= .1 ~ 0))
pairs(df %>%
filter(df$alto==1) %>%
select('Pobla80','muertes.permil',
'casos.permil','l10muertes.permil'),
col = "darkblue")
aux = df %>% filter(df$alto==1)
plot(y=aux$Pobla80, x=aux$muertes.permil, main='Efecto de poblaciones longevas\n sobre muertes en países con letalidad alta')
abline(h=4.5, col='red')
pairs(df %>%
select('ExpectVida','Pobla80','l10muertes.permil'), col = "darkblue")
corrplot(
cor(select_if(df, is.numeric)),
type='lower',
#addCoef.col="black",
number.cex=0.75,
mar=c(0,0,1,0),
title = 'Matriz de correlaciones'
)
lm.covid = lm(l10muertes.permil ~ PoblaDens + Pobla80 + Urbano +
Tuberculosis + Camas + TempMarzo + PBI,
data = COVID)
lm.covid_2 = lm(muertes.permil ~ PoblaDens + Pobla80 + Urbano +
Tuberculosis + Camas + TempMarzo + PBI,
data = COVID)
summary(lm.covid)
summary(lm.covid_2)
leverage_sorted=sort(hatvalues(lm.covid), decreasing = T)
boxplot(leverage_sorted,
main = "LEVERAGE DE LAS OBSERVACIONES PARA DISTINTOS PAISES",
col = "blue")
leverage_sorted[1:10]
plot(lm.covid, 4)
plot(lm.covid, 3)
cor.test(abs(lm.covid$residuals), lm.covid$fitted.values, method = "spearman")
plot(lm.covid, 2)
ks.test(lm.covid$residuals, "pnorm",
mean(lm.covid$residuals),
sd(lm.covid$residuals))
plot(lm.covid, 5)
step(lm.covid, direction = "both")
control = lmrobdet.control(bb = 0.5, efficiency = 0.85, family = "bisquare")
modelo_MM_covid = lmrobdetMM(l10muertes.permil ~ PoblaDens + Pobla80 + Urbano +
Tuberculosis + Camas + TempMarzo + PBI,
data = COVID, control = control)
summary(modelo_MM_covid)
(lm.covid$coefficients)
(modelo_MM_covid$coefficients)
plot(y = modelo_MM_covid$rweights,
x = modelo_MM_covid$residuals, col = "blue",
ylim = c(0, 1), xlab = "RESIDUOS", ylab = "RWEIGHTS",
main = "RWEIGHTS vs RESIDUOS MODELO ROBUSTO")
abline(h = 0, col = "red", lwd = 2)
df2 = COVID[, c("PoblaDens","Pobla80", "Urbano", "Tuberculosis", "Camas", "TempMarzo", "PBI")]
pairs(df2)
df2[, "PBIcamas"] = df2$Camas * df2$PBI
lm.covid_interaccion = lm(l10muertes.permil ~ PoblaDens + Pobla80 +
Urbano + Tuberculosis + Camas +
TempMarzo + PBI + PBIcamas, data = df2)
summary(lm.covid_interaccion)
df2[,"PBIpobla80"] = df2$PBI * df2$Pobla80
lm.covid_interaccion_2 = lm(l10muertes.permil ~ PoblaDens + Pobla80 +
Urbano + Tuberculosis + Camas +
TempMarzo + PBI + PBIpobla80, data = df2)
summary(lm.covid_interaccion_2)
df2[, "PBItemp"] = df2$TempMarzo * df2$PBI
lm.covid_interaccion_3 = lm(l10muertes.permil ~ PoblaDens + Pobla80 +
Urbano + Tuberculosis + Camas +
TempMarzo + PBI + PBItemp, data = df2)
summary(lm.covid_interaccion_3)
df2[, "PBIurbano"] = df2$Urbano * df2$PBI
lm.covid_interaccion_4 = lm(l10muertes.permil ~ PoblaDens + Pobla80 +
Urbano + Tuberculosis + Camas +
TempMarzo + PBI + PBIurbano, data = df2)
summary(lm.covid_interaccion_4)
df2[, "PBI^2"] = df2$PBI * df2$PBI
lm.covid_interaccion_5 = lm(l10muertes.permil ~ PoblaDens + Pobla80 +
Urbano + Tuberculosis + Camas +
TempMarzo + PBI + PBI^2, data = df2)
summary(lm.covid_interaccion_5)
step(lm.covid_interaccion_4, direction = "both")
int_prediccion = predict(lm.covid, newdata = COVID, interval = c("predict"))
plot(y = lm.covid$fitted.values,
x = COVID$l10muertes.permil,
col = "darkblue", ylim = c(-2, 5), cex = .8,
xlab = "VALORES OBSERVADOS", ylab = "VALORES PREDICHOS")
# Intervalos de prediccion
points(x = COVID$l10muertes.permil,
y = int_prediccion[, 2], col = "darkred", lwd =3, cex = 0.5)
points(x = COVID$l10muertes.permil,
y = int_prediccion[, 3], col = "darkred", lwd =3, cex = 0.5)
legend("topleft", c("INTERVALO DE PREDICCION", "OBSERVACION"), fill = c("darkred", "darkblue"))
df_for_vif = COVID[, -c(1, 2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
lm_for_vif = lm(l10muertes.permil ~., data = df_for_vif)
barplot(vif(lm_for_vif)[vif(lm_for_vif)>5], main = "VIF DE LAS COVARIABLES",
col = "blue", cex.names = 0.65)
abline(h = 5, lwd = 2, col = "red")
cov_altoVIF = names(vif(lm_for_vif)[vif(lm_for_vif)>5])
data.frame(t(cor(df_for_vif$Pobla80, df_for_vif[, cov_altoVIF],
method = "spearman")))
data.frame(t(cor(df_for_vif$Pobla65, df_for_vif[, cov_altoVIF],
method = "spearman")))
data.frame(t(cor(df_for_vif$ExpectVida, df_for_vif[, cov_altoVIF],
method = "spearman")))
data.frame(t(cor(df_for_vif$EnfTrans, df_for_vif[, cov_altoVIF],
method = "spearman")))
df3 = COVID[, -c(1, 3, 4, 8, 9, 21, 30, 31, 34, 36)]
#glimpse(df3)
covariables_l10muertes=df3[, -c(1, 2)]
covariables_muertes_permil=df3[, -c(1, 4)]
modelo_muertes_permil = lm(muertes.permil~. , data = covariables_muertes_permil)
summary(modelo_muertes_permil)
modelo_l10muertes = lm(l10muertes.permil~. , data = covariables_l10muertes)
summary(modelo_l10muertes)
wise_modelo_l10muertes = step(modelo_l10muertes, direction = c("both"),
trace = F)
summary(wise_modelo_l10muertes)
barplot(vif(wise_modelo_l10muertes), main = "VIF DE LAS COVARIABLES",col = "blue", cex.names = 0.65, ylim=c(0,6), las=2)
abline(h = 5, lwd = 2, col = "red")
wise_modelo_muertes_permil = step(modelo_muertes_permil, direction = c("both"),
trace = F)
summary(wise_modelo_muertes_permil)
back_modelo_l10muertes = step(modelo_l10muertes, direction = c("back"),
trace = F)
summary(back_modelo_l10muertes)
xx = model.matrix(l10muertes.permil ~., data = covariables_l10muertes)[, -1]
lassocv_modelo_l10muertes <- cv.glmnet(xx, y = l10muertes.permil,
alpha = 1,
nfolds = 5,
family = "gaussian",
type.measure = "mse")
lassocv_modelo_l10muertes$lambda.min
lassocv_modelo_l10muertes$lambda.1se
lasso_modelo_l10muertes_min <- glmnet(xx, y = l10muertes.permil,
alpha = 1,
lambda = lassocv_modelo_l10muertes$lambda.min)
lasso_modelo_l10muertes_1sd <- glmnet(xx, y = l10muertes.permil,
alpha = 1,
lambda = lassocv_modelo_l10muertes$lambda.1se)
cbind(coef(lasso_modelo_l10muertes_min),
coef(lasso_modelo_l10muertes_1sd))
ls_covid_lasso_final_1se = lm(l10muertes.permil ~ casos.permil + Pobla80 + ExpectVida +
BCG,  data = covariables_l10muertes)
summary(ls_covid_lasso_final_1se)
plot(wise_modelo_l10muertes)
par(mfrow=c(1, 3))
aux = COVID[COVID$casos.permil>3000,]
barplot(aux$casos.permil, names.arg=aux$geoId, las=2, main='Casos por mil por país')
barplot(aux$muertes.permil, names.arg=aux$geoId, las=2, main='Muertes por mil por país')
barplot(aux$PBI, names.arg=aux$geoId, las=2, main='PBI por país')
df4 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
df4 = df4[df4$geoId!='QA',]
modelo_l10muertes_V2 = lm(l10muertes.permil~. , data = df4[,-1])
summary(modelo_l10muertes_V2)
wise_modelo_l10muertes_V2 = step(modelo_l10muertes_V2, direction = c("both"),
trace = F)
summary(wise_modelo_l10muertes_V2)
plot(wise_modelo_l10muertes_V2)
aux = COVID[COVID$PoblaDens>3,]
barplot(aux$PoblaDens, names.arg=aux$geoId, las=2, main='Densidad poblacional por país')
df5 = df4[df4$geoId!='SG',]
modelo_l10muertes_V3 = lm(l10muertes.permil~. , data = df5[,-1])
summary(modelo_l10muertes_V3)
wise_modelo_muertes_permil_V3 = step(modelo_l10muertes_V3, direction = c("both"),
trace = F)
summary(wise_modelo_muertes_permil_V3)
plot(wise_modelo_muertes_permil_V3)
control = lmrobdet.control(bb = 0.5, efficiency = 0.85, family = "bisquare")
df6 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
modelo_MM_covid_V2 = lmrobdetMM(l10muertes.permil ~ .,
data = df6[,-1], control = control)
summary(modelo_MM_covid_V2)
plot(modelo_MM_covid_V2$residuals,modelo_MM_covid_V2$rweights)
df6 = df6[(df6$geoId!='US')&(df6$geoId!='CN')&(df6$geoId!='IN')&(df6$geoId!='QA')&(df6$geoId!='JP'),]
modelo_l10muertes_V3 = lm(l10muertes.permil~. , data = df6[,-1])
summary(modelo_l10muertes_V3)
wise_modelo_muertes_permil_V4 = step(modelo_l10muertes_V3, direction = c("both"),
trace = F)
formula_elegida = wise_modelo_muertes_permil_V4$call$formula #Nos guardamos las variables seleccionadas para utilizarlas luego
summary(wise_modelo_muertes_permil_V4)
modelo_MM_covid_V2 = lmrobdetMM(formula_elegida,
data = select_if(df6,is.numeric), control = control)
summary(modelo_MM_covid_V2)
plot(modelo_MM_covid_V2$residuals,modelo_MM_covid_V2$rweights)
df7 = COVID[, -c(2, 3, 4, 5, 8, 9, 21, 30, 31, 34, 36)]
car::boxTidwell(l10muertes.permil~casos.permil, data=df7[,-1])
df7$casos.permil = log(df7$casos.permil)
modelo_l10muertes_outliers = lm(l10muertes.permil~. , data = df7[,-1])
summary(modelo_l10muertes_outliers)
wise_modelo_muertes_permil_V4 = step(modelo_l10muertes_outliers, direction = c("both"),
trace = F)
formula_elegida = wise_modelo_muertes_permil_V4$call$formula
summary(wise_modelo_muertes_permil_V4)
plot(wise_modelo_muertes_permil_V4)
modelo_MM_covid_log = lmrobdetMM(formula_elegida,
data = select_if(df7,is.numeric), control = control)
summary(modelo_MM_covid_log)
plot(modelo_MM_covid_log$residuals,modelo_MM_covid_log$rweights)
final_model = wise_modelo_muertes_permil_V4
summary(lm.covid)
summary(final_model)
plot(lm.covid)
plot(final_model)
par(mfrow=c(1, 2))
int_prediccion = predict(lm.covid, newdata = COVID, interval = c("predict"))
int_prediccion_2 = predict(wise_modelo_muertes_permil_V4, newdata = df7, interval = c("predict"))
plot(y = lm.covid$fitted.values,
x = COVID$l10muertes.permil,
col = "darkblue", ylim = c(-2, 5), cex = .8,
xlab = "VALORES OBSERVADOS", ylab = "VALORES PREDICHOS", main='Intervalos de predicción modelo 1')
# Intervalos de prediccion
points(x = COVID$l10muertes.permil,
y = int_prediccion[, 2], col = "darkred", lwd =3, cex = 0.5)
points(x = COVID$l10muertes.permil,
y = int_prediccion[, 3], col = "darkred", lwd =3, cex = 0.5)
legend("topleft", c("INTERVALO DE PREDICCION", "OBSERVACION"), fill = c("darkred", "darkblue"))
plot(y = wise_modelo_muertes_permil_V4$fitted.values,
x = df7$l10muertes.permil,
col = "darkblue", ylim = c(-2, 5), cex = .8,
xlab = "VALORES OBSERVADOS", ylab = "VALORES PREDICHOS", main='Intervalos de predicción modelo 2')
# Intervalos de prediccion
points(x = df7$l10muertes.permil,
y = int_prediccion_2[, 2], col = "darkred", lwd =3, cex = 0.5)
points(x = df7$l10muertes.permil,
y = int_prediccion_2[, 3], col = "darkred", lwd =3, cex = 0.5)
legend("topleft", c("INTERVALO DE PREDICCION", "OBSERVACION"), fill = c("darkred", "darkblue"))
plot(wise_modelo_muertes_permil_V4)
